<!doctype html>
<html lang="es">
<head>
<style>
 body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
 .container { background:white; padding:25px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); max-width:900px; margin:auto; }
 h1 { text-align:center; color:#1a237e; }
 fieldset { border:2px solid #1a237e; padding:15px; margin-bottom:20px; border-radius:10px; }
 legend { font-weight:bold; color:#1a237e; }
 label { font-weight:bold; }
 input, select, textarea { width:100%; padding:8px; margin-top:5px; border:1px solid #aaa; border-radius:6px; }
 .logo { text-align:center; margin-bottom:20px; font-size:28px; font-weight:bold; color:#0d47a1; letter-spacing:2px; }
 .signature-box { border:1px solid #999; border-radius:8px; background:white; }
 button { padding:10px 20px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; }
 .btn-primary { background:#1a237e; color:white; }
 .btn-secondary { background:#3949ab; color:white; }
</style>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Registro de Mantenimiento - Correctivo / Preventivo</title>
  <style>
    :root{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;--accent:#0b74de}
    body{margin:0;padding:24px;background:#f4f6f8;color:#111}
    .container{max-width:980px;margin:0 auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 20px rgba(12,20,30,0.06)}
    h1{font-size:20px;margin:0 0 8px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:200px}
    label{display:block;font-size:13px;margin-bottom:6px}
    input[type=text],input[type=date],select,textarea{width:100%;padding:8px;border:1px solid #d6dbe0;border-radius:6px;font-size:14px}
    textarea{min-height:80px;resize:vertical}
    .radioGroup{display:flex;gap:12px;align-items:center}
    .card{background:#fbfdff;padding:12px;border-radius:8px;border:1px solid #eef3fb}
    .checklist{display:flex;flex-direction:column;gap:6px}
    .small{font-size:13px;color:#444}
    footer{display:flex;gap:12px;justify-content:space-between;align-items:center;margin-top:16px}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer}
    button.secondary{background:#eee;color:#222}
    .sign-wrap{display:flex;gap:16px;align-items:flex-start}
    .sign-box{flex:1}
    canvas.signature{width:100%;height:140px;border:1px dashed #bfcbd9;border-radius:6px;background:#fff}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .meta{font-size:13px;color:#666;margin-bottom:8px}
    .print-ready{display:none}
    @media print{body{background:#fff} .container{box-shadow:none;border:none} .no-print{display:none} .print-ready{display:block}}
  </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div class="logo"><img src="./megatecnology.png" alt="Logo" style="max-width:180px; margin:auto; display:block;"> <br>MEGATECNOLOGY</div>
<div class="container">
  <div class="container">
    <h1>Registro de Mantenimiento</h1>
    <p class="meta">Formulario para registrar servicios correctivos o preventivos. Imprime o exporta desde el navegador.</p>

    <form id="maintForm">
      <div class="row">
        <div class="col card">
          <label>Tipo de mantenimiento</label>
          <div class="radioGroup">
            <label><input type="radio" name="tipo" value="Correctivo" checked> Correctivo</label>
            <label><input type="radio" name="tipo" value="Preventivo"> Preventivo</label>
          </div>

          <label>Fecha</label>
          <input type="date" name="fecha" required>

          <label>Técnico</label>
          <input type="text" name="tecnico" placeholder="Nombre del técnico" required>

          <label>Cliente</label>
          <input type="text" name="cliente" placeholder="Nombre del cliente / empresa" required>

          <label>Contacto</label>
          <input type="text" name="contacto" placeholder="Teléfono / correo">
        </div>

        <div class="col card">
          <label>Datos del equipo</label>
          <div class="row">
            <div class="col">
              <label>Tipo</label>
              <select name="tipoEquipo">
                <option>PC de escritorio</option>
                <option>Portátil</option>
                <option>Servidor</option>
                <option>Impresora</option>
                <option>Otro</option>
              </select>
            </div>
            <div class="col">
              <label>Marca</label>
              <input type="text" name="marca">
            </div>
            <div class="col">
              <label>Modelo</label>
              <input type="text" name="modelo">
            </div>
          </div>

          <label>Número de serie / Inventario</label>
          <input type="text" name="serie">

          <label>Problema reportado</label>
          <textarea name="problema"></textarea>

        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <label>Acciones realizadas</label>
        <textarea name="acciones" placeholder="Describir pasos realizados, pruebas y resultados" required></textarea>

        <label>Repuestos / materiales usados</label>
        <input type="text" name="repuestos" placeholder="Ej: fuente 500W, pasta térmica, SSD 256GB">

        <label>Observaciones</label>
        <textarea name="observaciones"></textarea>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <label>Checklist</label>
        <div class="checklist" id="checklist">
          <label><input type="checkbox" name="chk" value="Encendido y prueba"> Encendido y prueba</label>
          <label><input type="checkbox" name="chk" value="Limpieza interna"> Limpieza interna</label>
          <label><input type="checkbox" name="chk" value="Actualización de drivers/OS"> Actualización de drivers/OS</label>
          <label><input type="checkbox" name="chk" value="Backup de datos"> Backup de datos</label>
          <label><input type="checkbox" name="chk" value="Prueba de red y conectividad"> Prueba de red y conectividad</label>
        </div>
        <div style="margin-top:8px" class="row">
          <input type="text" id="newChkText" placeholder="Agregar elemento" class="col">
          <button type="button" class="secondary" id="addChk">Agregar</button>
        </div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <label>Firmas</label>
        <div class="sign-wrap">
          <div class="sign-box">
            <div class="small">Firma del técnico</div>
            <canvas id="sigTech" class="signature"></canvas>
            <div class="actions no-print" style="margin-top:8px">
              <button type="button" id="clearTech" class="secondary">Borrar</button>
            </div>
            <input type="text" name="firmaTecnicoNombre" placeholder="Nombre (firma)" style="margin-top:8px">
          </div>

          <div class="sign-box">
            <div class="small">Firma del cliente</div>
            <canvas id="sigClient" class="signature"></canvas>
            <div class="actions no-print" style="margin-top:8px">
              <button type="button" id="clearClient" class="secondary">Borrar</button>
            </div>
            <input type="text" name="firmaClienteNombre" placeholder="Nombre (firma)" style="margin-top:8px">
          </div>
        </div>
      </div>

      <footer class="no-print">
        <div class="small">Revisar todos los campos antes de imprimir.</div>
        <div>
          <button type="button" id="preview">Vista previa / Imprimir</button>
          <button type="submit" id="save" class="secondary">Guardar (local)</button>
        </div>
      </footer>

    </form>

    <div class="print-ready" id="printArea"></div>
  </div>

  <script>
// --- FIRMA TECNICO ---
function initSignature(canvasId, clearBtnId) {
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext("2d");
  let signing = false;

  canvas.addEventListener("mousedown", e => {
    signing = true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
  });

  canvas.addEventListener("mousemove", e => {
    if (!signing) return;
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
  });

  canvas.addEventListener("mouseup", () => signing = false);
  canvas.addEventListener("mouseleave", () => signing = false);

  document.getElementById(clearBtnId).addEventListener("click", () => {
    ctx.clearRect(0,0,canvas.width,canvas.height);
  });
}

initSignature("sigTech","clearTech");
initSignature("sigClient","clearClient");

// --- GENERAR PDF ---
function generarPDF(){
  const pdf = new jspdf.jsPDF("p","pt","a4");

  // Encabezado con logo
  const logo = new Image();
  logo.src = "megatecnology.png";
  pdf.addImage(logo, "PNG", 20, 10, 120, 40);
  pdf.setFillColor(13,71,161);
  pdf.rect(0,0,595,60,"F");
  pdf.setFontSize(20);
  pdf.setTextColor(255,255,255);
  pdf.text("MEGATECNOLOGY - Informe de Mantenimiento", 160, 38);

  pdf.setTextColor(0,0,0);

  // --- MARCA DE AGUA (LOGO GRANDE) ---
  try {
    const watermark = new Image();
    watermark.src = "megatecnology.png";
    if (pdf.setGState) {
      const gs = pdf.GState({ opacity: 0.08 });
      pdf.setGState(gs);
    }
    pdf.addImage(watermark, "PNG", 100, 200, 400, 400);
    if (pdf.setGState) pdf.setGState(pdf.GState({ opacity: 1 }));
  } catch (e) { console.error("Marca de agua no soportada", e); }
(255,255,255);
  pdf.text("MEGATECNOLOGY - Informe de Mantenimiento", 40, 38);

  pdf.setTextColor(0,0,0);
  pdf.setFontSize(12);
  let y = 90;

  const campos = document.querySelectorAll("fieldset");
  campos.forEach(fs=>{
    pdf.setFontSize(14);
    pdf.text(fs.querySelector("legend").innerText, 40, y);
    y+=20;

    const elementos = fs.querySelectorAll("input, select, textarea");
    elementos.forEach(el=>{
      if(el.value){
        pdf.setFontSize(11);
        pdf.text(`${el.previousElementSibling?.innerText || el.id}: ${el.value}`, 50, y);
        y+=16;
      }
    });

    y+=10;
  });

  // Checklist
  pdf.setFontSize(14);
  pdf.text("Checklist", 40, y);
  y+=20;
  document.querySelectorAll("input[type=checkbox]").forEach(ch=>{
    pdf.setFontSize(11);
    const estado = ch.checked ? "✔" : "✘";
    pdf.text(`${estado}  ${ch.dataset.label}`, 50, y);
    y+=16;
  });

  // Firmas
  y+=30;
  pdf.setFontSize(12);
  pdf.text("Firma del Técnico", 40, y);
  const firmaTec = document.getElementById("firmaTecnico");
  pdf.addImage(firmaTec.toDataURL("image/png"), "PNG", 40, y+10, 200, 100);

  pdf.text("Firma del Cliente", 300, y);
  const firmaCli = document.getElementById("firmaCliente");
  pdf.addImage(firmaCli.toDataURL("image/png"), "PNG", 300, y+10, 200, 100);

  pdf.save("mantenimiento_megatecnology.pdf");("mantenimiento.pdf");
}
</script>
      </div>
</body></html>`;
    }

    function escapeHtml(str){ if(!str) return ''; return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#39;'); }

  </script>
</body>
</html>







